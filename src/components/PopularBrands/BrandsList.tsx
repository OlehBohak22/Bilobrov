import { useSelector } from "react-redux";
import type { RootState } from "../../store";
import { Layout } from "../Layout/Layout";
import s from "./PopularBrands.module.css";
import { Swiper, SwiperSlide } from "swiper/react";
import "swiper/css";
import "swiper/css/navigation";
import { Navigation } from "swiper/modules";
import { Link } from "react-router";
import { useWindowSize } from "../../hooks/useWindowSize";
import { useState } from "react";

const BrandsList = () => {
  const { items } = useSelector((state: RootState) => state.brands);
  const { width } = useWindowSize();
  const isMobile = width < 1024;
  const [, setSwiperInstance] = useState<any>(null);
  const [progress, setProgress] = useState(1);

  const updateProgress = (swiper: any) => {
    const slidesPerView =
      typeof swiper.params.slidesPerView === "number"
        ? swiper.params.slidesPerView
        : 1;
    const total = swiper.slides.length - slidesPerView + 1;
    setProgress((swiper.realIndex + 1) / total);
  };

  return (
    <section className={s.section}>
      <Layout>
        <div className={s.brandsContainer}>
          <h2>
            <span>Популярні</span>
            <span>бренди</span>
          </h2>

          <Swiper
            onSwiper={(swiper) => {
              setSwiperInstance(swiper);
              setTimeout(() => updateProgress(swiper), 1000);
            }}
            onSlideChange={updateProgress}
            className={s.swiper}
            modules={[Navigation]}
            slidesPerView={isMobile ? 3.5 : 7}
            spaceBetween={20}
            navigation={{
              prevEl: `.${s.prevButton}`,
              nextEl: `.${s.nextButton}`,
            }}
          >
            {items.map((brand) => (
              <SwiperSlide className={s.brandItem} key={brand.id}>
                <Link to={`/catalog?brand=${brand.id}`}>
                  <div className={s.brandImageCircle}>
                    <div className="overflow-hidden rounded-full w-full h-full">
                      {brand.popular_product.image && (
                        <img
                          src={brand.popular_product.image}
                          alt={brand.name}
                        />
                      )}
                    </div>
                  </div>
                  <h4>{brand.name}</h4>
                </Link>
              </SwiperSlide>
            ))}
          </Swiper>

          {isMobile && (
            <div className={s.progressBarWrapper}>
              <div
                className={s.progressBarFill}
                style={{ transform: `scaleX(${progress})` }}
              />
            </div>
          )}
        </div>

        <div className={s.bottomController}>
          <Link className={s.brandLink} to="/brendy">
            <span>Всі бренди</span>
            <svg
              className={s.svg}
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M9.33301 9.33325L22.6663 22.6666M22.6663 22.6666V9.33325M22.6663 22.6666H9.33301"
                stroke="white"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>

            <svg
              className={s.line}
              viewBox="0 0 294 72"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M284.287 14.5452C261.072 8.38649 199.054 -2.69916 136.704 2.2278C74.354 7.15475 44.3952 14.5453 37.2095 17.6247C18.9689 23.7834 -12.5376 39.3854 7.36121 52.5239C32.2348 68.9471 83.6398 71 156.602 71C207.79 71 253.366 61.5275 276.109 55.0428C281.579 53.4834 287.256 51.4224 290.662 46.8678C299.376 35.2137 287.483 17.7233 189.767 11.466"
                stroke="#ffffff"
                strokeLinecap="round"
              />
            </svg>
          </Link>

          {!isMobile && (
            <div className={s.navigationContainer}>
              <button className={s.prevButton}>
                <svg
                  viewBox="0 0 25 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clipPath="url(#clip0_480_5408)">
                    <path d="M7.08228 5L8.15132 6.05572L3.39413 10.7535L24.5 10.7535V12.2465L3.39413 12.2465L8.15132 16.9443L7.08228 18L0.5 11.5L7.08228 5Z" />
                  </g>
                  <defs>
                    <clipPath id="clip0_480_5408">
                      <rect
                        width="24"
                        height="24"
                        fill="white"
                        transform="matrix(-1 0 0 1 24.5 0)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              </button>
              <button className={s.nextButton}>
                <svg
                  viewBox="0 0 25 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clipPath="url(#clip0_480_5411)">
                    <path d="M17.9177 5L16.8487 6.05572L21.6059 10.7535H0.5V12.2465H21.6059L16.8487 16.9443L17.9177 18L24.5 11.5L17.9177 5Z" />
                  </g>
                  <defs>
                    <clipPath id="clip0_480_5411">
                      <rect
                        width="24"
                        height="24"
                        fill="white"
                        transform="translate(0.5)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              </button>
            </div>
          )}
        </div>
      </Layout>

      <svg
        className={s.sectionLineSvg}
        viewBox="0 0 1399 152"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask id="path-1-inside-1_596_4461" fill="white">
          <path d="M1414.33 74.9449C1384.85 58.9143 1352.53 48.5506 1319.13 44.8253C1276.33 40.0504 1235.12 46.8982 1193.83 57.8039C1124.23 76.1905 1050.16 87.5266 978.18 78.404C953.522 75.2759 928.968 69.7985 906.541 58.9306C901.001 56.2436 897.239 51.8867 892.239 48.4534C885.766 44.0063 877.518 42.7704 869.898 44.4859C848.673 49.2655 844.918 70.7896 831.831 84.6942C824.307 92.6903 814.364 98.5045 803.674 101.106C791.735 104.005 776.776 101.882 774.674 87.394C774.099 83.4332 774.219 79.2459 774.938 75.0342C776.966 74.4916 778.972 73.9219 780.947 73.3257C792.698 69.7958 804.362 64.8768 814.807 58.4028C819.926 55.2275 832.952 46.6193 830.145 39.0379C827.584 32.1193 814.172 32.1324 808.404 33.04C798.115 34.6632 789.284 40.6584 783.071 48.8604C778.841 54.4456 774.326 63.0864 772.002 72.0066C761.598 74.6705 750.37 76.5822 739.874 74.9222C736.796 74.4359 733.418 73.6346 730.432 72.2074C736.135 66.01 741.97 59.3623 745.744 52.2173C748.309 47.3669 749.661 40.6726 744.339 37.1366C729.483 27.2796 713.889 54.5484 719.411 66.612C720.617 69.2517 722.479 71.3572 724.723 73.0345C722.851 75.0752 720.971 77.0883 719.088 79.0663C711.232 87.3332 702.929 95.5602 693.176 101.604C690.657 103.165 685.789 106.7 682.607 106.254C677.147 105.492 674.234 100.203 673.64 95.3566C672.75 88.069 675.59 80.9166 678.962 74.6021C684.439 64.3412 691.463 54.7735 697.829 45.0431C698.706 43.7021 697.044 41.9309 695.624 42.4699C684.297 46.8011 672.26 50.536 660.014 52.9868C659.737 51.7484 659.287 50.5754 658.615 49.4914C650.681 36.7026 631.063 46.9444 626.304 57.0128C625.681 58.3336 626.633 59.6351 628.027 59.6747C637.488 59.9249 647.102 59.034 656.632 57.352C656.477 59.3943 655.943 61.4706 655.516 63.2949C652.841 74.697 647.622 85.5357 640.44 94.809C636.959 99.3062 632.83 104.126 628.222 107.5C618.408 114.673 610.573 107.573 609.423 97.3426C608.764 91.5279 609.142 85.2577 610.406 79.1593C614.375 73.3133 618.944 66.6404 617.57 59.4344C617.248 57.7409 614.922 58.0035 614.199 59.1746C610.474 65.2261 608.265 71.7541 607.012 78.591C603.904 82.8012 600.471 86.599 598.204 89.1814C591.796 96.4926 584.291 103.502 575.85 108.442C570.831 111.38 564.311 113.728 558.72 110.734C552.257 107.279 552.198 98.7438 552.489 92.4289C552.869 84.1807 554.744 75.8471 557.124 67.8602C573.222 59.0979 588.816 47.8564 600.52 33.8694C605.941 27.3983 623.209 5.5038 607.771 0.843779C591.91 -3.94186 578.556 15.9174 571.604 26.882C564.052 38.8002 558.038 51.8766 553.988 65.4765C549.822 67.6938 545.59 69.7457 541.321 71.6094C531.911 75.7135 520.235 81.7522 510.159 77.4658C505.801 75.6107 501.344 74.1831 496.729 73.0947C468.329 66.383 437.723 68.5501 409.142 72.6593C381.976 76.5606 355.198 82.9897 328.916 90.8075C291.41 101.952 255.793 117.325 219.184 130.879C150.089 156.454 74.9451 172.429 2.74065 155.519C0.436788 154.978 -0.344042 158.552 1.9524 159.086C72.0752 175.514 145.179 160.794 212.746 137.087C235.222 129.201 256.991 119.417 279.351 111.199C298.397 104.197 317.664 97.7883 337.173 92.2048C366.032 83.9493 395.516 77.3644 425.419 74.3331C451.154 71.7175 480.71 70.1474 505.472 79.464C506.648 79.9092 507.778 80.4342 508.928 80.9371C522.381 86.8343 539.976 76.6985 551.926 70.6243C552.181 70.4983 552.428 70.3587 552.683 70.2327C551.511 74.7074 550.54 79.2349 549.81 83.785C547.616 97.4846 548.735 118.972 568.341 115.382C576.734 113.844 584.129 107.565 590.374 102.135C596.193 97.0716 601.458 91.404 606.097 85.2554C606.069 85.5454 606.035 85.8358 606.008 86.1328C605.319 93.8904 604.837 102.897 610.167 109.262C622.486 123.982 638.919 103.546 645.847 93.6106C650.777 86.5458 654.632 78.7912 657.284 70.6C658.566 66.6262 660.338 61.4515 660.383 56.6487C671.048 54.5271 681.551 51.4568 691.561 47.8704C684.637 58.0101 676.979 68.3149 672.576 79.6386C669.382 87.8583 667.787 99.3587 674.524 106.417C681.545 113.771 691.467 107.296 698.146 102.737C708.271 95.8153 717.062 86.7814 725.296 77.7766C726.139 76.8597 726.994 75.928 727.864 74.9885C732.571 77.4376 738.227 78.549 743.129 78.9255C752.368 79.6449 761.947 78.2279 771.13 76.001C769.27 86.3399 770.833 96.4922 779.675 102.181C796.321 112.894 820.787 100.765 833.077 88.648C842.034 79.8236 845.519 67.5625 853.845 58.4193C864.543 46.6671 881.275 43.39 893.729 54.3652C901.96 61.6131 911.615 65.809 921.933 69.4563C976.864 88.8902 1038.98 87.8238 1095.99 80.7745C1120.2 77.7817 1144.23 73.3827 1168 67.9352C1196.73 61.3473 1224.75 52.3543 1254.13 48.865C1299.47 43.4766 1345.81 48.713 1388.02 66.3357C1396.44 69.8504 1404.64 73.8338 1412.64 78.1867C1414.72 79.3165 1416.4 76.0684 1414.32 74.9383L1414.33 74.9449ZM813.837 36.2535C816.424 36.2728 819.087 36.6541 821.559 37.4396C827.301 39.2503 826.237 43.3674 823.062 47.0954C819.52 51.2508 814.767 54.2802 810.061 56.9693C799.809 62.8208 788.768 67.3482 777.404 70.5692C776.881 70.7162 776.345 70.864 775.816 71.0114C780.489 53.1134 795.548 36.121 813.831 36.2679L813.837 36.2535ZM631.059 56.0527C633.987 51.6409 638.438 48.6554 643.91 47.89C648.12 47.3034 654.121 47.742 656.084 52.707C656.207 53.0244 656.309 53.3499 656.39 53.6764C647.974 55.1803 639.476 56.048 631.059 56.0527ZM558.803 62.5565C564.542 45.039 573.624 26.0582 586.803 12.8245C589.992 9.62372 593.702 6.65603 598.016 5.09261C600.436 4.21262 603.63 3.27097 606.186 4.16469C613.161 6.60053 609.616 12.3047 607.95 15.848C603.849 24.5657 597.726 32.1928 590.855 38.9018C581.369 48.1622 570.364 56.214 558.686 62.8864C558.722 62.7719 558.759 62.6643 558.796 62.5498L558.803 62.5565ZM727.214 70.2784C726.162 69.4889 725.203 68.5819 724.413 67.5253C719.58 61.0777 722.576 52.6995 726.805 46.692C728.804 43.8562 731.496 40.8715 734.873 39.6317C738.52 38.3003 743.93 40.0017 744.423 44.1428C744.777 47.1157 742.654 50.4366 741.061 52.8076C736.957 58.9071 732.187 64.7106 727.222 70.2851L727.214 70.2784Z" />
        </mask>
        <path
          d="M1414.33 74.9449C1384.85 58.9143 1352.53 48.5506 1319.13 44.8253C1276.33 40.0504 1235.12 46.8982 1193.83 57.8039C1124.23 76.1905 1050.16 87.5266 978.18 78.404C953.522 75.2759 928.968 69.7985 906.541 58.9306C901.001 56.2436 897.239 51.8867 892.239 48.4534C885.766 44.0063 877.518 42.7704 869.898 44.4859C848.673 49.2655 844.918 70.7896 831.831 84.6942C824.307 92.6903 814.364 98.5045 803.674 101.106C791.735 104.005 776.776 101.882 774.674 87.394C774.099 83.4332 774.219 79.2459 774.938 75.0342C776.966 74.4916 778.972 73.9219 780.947 73.3257C792.698 69.7958 804.362 64.8768 814.807 58.4028C819.926 55.2275 832.952 46.6193 830.145 39.0379C827.584 32.1193 814.172 32.1324 808.404 33.04C798.115 34.6632 789.284 40.6584 783.071 48.8604C778.841 54.4456 774.326 63.0864 772.002 72.0066C761.598 74.6705 750.37 76.5822 739.874 74.9222C736.796 74.4359 733.418 73.6346 730.432 72.2074C736.135 66.01 741.97 59.3623 745.744 52.2173C748.309 47.3669 749.661 40.6726 744.339 37.1366C729.483 27.2796 713.889 54.5484 719.411 66.612C720.617 69.2517 722.479 71.3572 724.723 73.0345C722.851 75.0752 720.971 77.0883 719.088 79.0663C711.232 87.3332 702.929 95.5602 693.176 101.604C690.657 103.165 685.789 106.7 682.607 106.254C677.147 105.492 674.234 100.203 673.64 95.3566C672.75 88.069 675.59 80.9166 678.962 74.6021C684.439 64.3412 691.463 54.7735 697.829 45.0431C698.706 43.7021 697.044 41.9309 695.624 42.4699C684.297 46.8011 672.26 50.536 660.014 52.9868C659.737 51.7484 659.287 50.5754 658.615 49.4914C650.681 36.7026 631.063 46.9444 626.304 57.0128C625.681 58.3336 626.633 59.6351 628.027 59.6747C637.488 59.9249 647.102 59.034 656.632 57.352C656.477 59.3943 655.943 61.4706 655.516 63.2949C652.841 74.697 647.622 85.5357 640.44 94.809C636.959 99.3062 632.83 104.126 628.222 107.5C618.408 114.673 610.573 107.573 609.423 97.3426C608.764 91.5279 609.142 85.2577 610.406 79.1593C614.375 73.3133 618.944 66.6404 617.57 59.4344C617.248 57.7409 614.922 58.0035 614.199 59.1746C610.474 65.2261 608.265 71.7541 607.012 78.591C603.904 82.8012 600.471 86.599 598.204 89.1814C591.796 96.4926 584.291 103.502 575.85 108.442C570.831 111.38 564.311 113.728 558.72 110.734C552.257 107.279 552.198 98.7438 552.489 92.4289C552.869 84.1807 554.744 75.8471 557.124 67.8602C573.222 59.0979 588.816 47.8564 600.52 33.8694C605.941 27.3983 623.209 5.5038 607.771 0.843779C591.91 -3.94186 578.556 15.9174 571.604 26.882C564.052 38.8002 558.038 51.8766 553.988 65.4765C549.822 67.6938 545.59 69.7457 541.321 71.6094C531.911 75.7135 520.235 81.7522 510.159 77.4658C505.801 75.6107 501.344 74.1831 496.729 73.0947C468.329 66.383 437.723 68.5501 409.142 72.6593C381.976 76.5606 355.198 82.9897 328.916 90.8075C291.41 101.952 255.793 117.325 219.184 130.879C150.089 156.454 74.9451 172.429 2.74065 155.519C0.436788 154.978 -0.344042 158.552 1.9524 159.086C72.0752 175.514 145.179 160.794 212.746 137.087C235.222 129.201 256.991 119.417 279.351 111.199C298.397 104.197 317.664 97.7883 337.173 92.2048C366.032 83.9493 395.516 77.3644 425.419 74.3331C451.154 71.7175 480.71 70.1474 505.472 79.464C506.648 79.9092 507.778 80.4342 508.928 80.9371C522.381 86.8343 539.976 76.6985 551.926 70.6243C552.181 70.4983 552.428 70.3587 552.683 70.2327C551.511 74.7074 550.54 79.2349 549.81 83.785C547.616 97.4846 548.735 118.972 568.341 115.382C576.734 113.844 584.129 107.565 590.374 102.135C596.193 97.0716 601.458 91.404 606.097 85.2554C606.069 85.5454 606.035 85.8358 606.008 86.1328C605.319 93.8904 604.837 102.897 610.167 109.262C622.486 123.982 638.919 103.546 645.847 93.6106C650.777 86.5458 654.632 78.7912 657.284 70.6C658.566 66.6262 660.338 61.4515 660.383 56.6487C671.048 54.5271 681.551 51.4568 691.561 47.8704C684.637 58.0101 676.979 68.3149 672.576 79.6386C669.382 87.8583 667.787 99.3587 674.524 106.417C681.545 113.771 691.467 107.296 698.146 102.737C708.271 95.8153 717.062 86.7814 725.296 77.7766C726.139 76.8597 726.994 75.928 727.864 74.9885C732.571 77.4376 738.227 78.549 743.129 78.9255C752.368 79.6449 761.947 78.2279 771.13 76.001C769.27 86.3399 770.833 96.4922 779.675 102.181C796.321 112.894 820.787 100.765 833.077 88.648C842.034 79.8236 845.519 67.5625 853.845 58.4193C864.543 46.6671 881.275 43.39 893.729 54.3652C901.96 61.6131 911.615 65.809 921.933 69.4563C976.864 88.8902 1038.98 87.8238 1095.99 80.7745C1120.2 77.7817 1144.23 73.3827 1168 67.9352C1196.73 61.3473 1224.75 52.3543 1254.13 48.865C1299.47 43.4766 1345.81 48.713 1388.02 66.3357C1396.44 69.8504 1404.64 73.8338 1412.64 78.1867C1414.72 79.3165 1416.4 76.0684 1414.32 74.9383L1414.33 74.9449ZM813.837 36.2535C816.424 36.2728 819.087 36.6541 821.559 37.4396C827.301 39.2503 826.237 43.3674 823.062 47.0954C819.52 51.2508 814.767 54.2802 810.061 56.9693C799.809 62.8208 788.768 67.3482 777.404 70.5692C776.881 70.7162 776.345 70.864 775.816 71.0114C780.489 53.1134 795.548 36.121 813.831 36.2679L813.837 36.2535ZM631.059 56.0527C633.987 51.6409 638.438 48.6554 643.91 47.89C648.12 47.3034 654.121 47.742 656.084 52.707C656.207 53.0244 656.309 53.3499 656.39 53.6764C647.974 55.1803 639.476 56.048 631.059 56.0527ZM558.803 62.5565C564.542 45.039 573.624 26.0582 586.803 12.8245C589.992 9.62372 593.702 6.65603 598.016 5.09261C600.436 4.21262 603.63 3.27097 606.186 4.16469C613.161 6.60053 609.616 12.3047 607.95 15.848C603.849 24.5657 597.726 32.1928 590.855 38.9018C581.369 48.1622 570.364 56.214 558.686 62.8864C558.722 62.7719 558.759 62.6643 558.796 62.5498L558.803 62.5565ZM727.214 70.2784C726.162 69.4889 725.203 68.5819 724.413 67.5253C719.58 61.0777 722.576 52.6995 726.805 46.692C728.804 43.8562 731.496 40.8715 734.873 39.6317C738.52 38.3003 743.93 40.0017 744.423 44.1428C744.777 47.1157 742.654 50.4366 741.061 52.8076C736.957 58.9071 732.187 64.7106 727.222 70.2851L727.214 70.2784Z"
          fill="white"
          stroke="#D63D44"
          strokeWidth="2"
          mask="url(#path-1-inside-1_596_4461)"
        />
      </svg>
    </section>
  );
};

export default BrandsList;
